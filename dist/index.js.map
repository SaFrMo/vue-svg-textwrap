{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["function getConfig(mod, cfg) {\n\tconst ret = {\n\t\t'plain': !cfg.plain ? false : true,\n\t\t'width': null || cfg.width,\n\t\t'align': cfg.align || 'baseline',\n\t\t'lineHeight': cfg.lineHeight || '1.125em',\n\t\t'paddingLeft': cfg.paddingLeft === undefined ? (cfg.padding === undefined ? 0 : cfg.padding) : cfg.paddingLeft,\n\t\t'paddingRight': cfg.paddingRight === undefined ? (cfg.padding === undefined ? 0 : cfg.padding) : cfg.paddingRight,\n\t\t'afterReflow': cfg.afterReflow instanceof Function ? cfg.afterReflow : false\n\t};\n\tret.padding = ret.paddingLeft + ret.paddingRight;\n\tfor (let k in mod) {\n\t\tif (k === 'plain') ret.plain = true;\n\t\telse if (k === 'baseline' || k === 'top' || k === 'bottom' || k === 'middle' || k === 'none')\n\t\t\tret.align = k;\n\t\telse if (/\\d+/.test(k))\n\t\t\tret.width = parseInt(k);\n\t}\n\treturn ret;\n}\n/**\n * @param {SVGTextElement} el \n * @param {SVGTSpanElement} span \n * @param {*} config \n */\nfunction newLine(el, span, config) {\n\tconst tmp = span.cloneNode();\n\tel.insertBefore(tmp, span.nextSibling);\n\tspan.style.display = null;\n\ttmp.removeAttribute('y');\n\ttmp.setAttribute('dy', config.lineHeight);\n\ttmp.setAttribute('x', config.paddingLeft);\n\treturn tmp;\n}\n/**\n * @param {SVGTextElement} el \n * @param {String} text \n * @param {Object} config \n */\nfunction set(el, text, config) {\n\tel[config.plain ? 'textContent' : 'innerHTML'] = text || '';\n\tif (!config.width) return;\n\tconst plain = [];\n\tconst physLn = el.getBBox().height; // physical line height\n\t// convert text nodes to tspans, clear spans\n\tfor (let i = 0; i < el.childNodes.length; i++) {\n\t\tlet n = el.childNodes[i];\n\t\tif (n instanceof Text) {\n\t\t\tconst tmp = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');\n\t\t\ttmp.textContent = n.textContent;\n\t\t\tel.replaceChild(tmp, n);\n\t\t\tn = tmp;\n\t\t}\n\t\tplain.push(n.textContent.split(' '));\n\t\tn.textContent = '';\n\t}\n\tif (el.childElementCount) {\n\t\tel.childNodes[0].setAttribute('y', 0);\n\t\tel.childNodes[0].setAttribute('x', config.paddingLeft);\n\t}\n\n\t// float texts\n\tlet offset = 0, w = config.width - config.padding, childCnt = el.childElementCount;\n\tfor (let c = 0; c < childCnt; c++) {\n\t\tconst words = plain[c];\n\t\tlet wc = words.length, span = el.childNodes[c + offset], txt = '', forceBreak = false;\n\t\tfor (let i = 0; i < wc; i++) {\n\t\t\tspan.textContent += i ? ' ' + words[i] : words[i];\n\t\t\tforceBreak = el.getBBox().width > w;\n\t\t\twhile (forceBreak) {\n\t\t\t\tspan.textContent = txt;\n\t\t\t\tspan = newLine(el, span, config);\n\t\t\t\ttxt = span.textContent = words[i];\n\t\t\t\toffset++;\n\t\t\t\tif (el.getBBox().width > w) {\n\t\t\t\t\tspan.style.display = 'none'; // too long word, hide for further correct measurements\n\t\t\t\t\ttxt = words[++i];\n\t\t\t\t\tif (!txt) forceBreak = false;\n\t\t\t\t} else forceBreak = false;\n\t\t\t}\n\t\t\ttxt = span.textContent;\n\t\t}\n\t}\n\n\tfor (let i = 0; i < el.childNodes.length; i++)\n\t\tel.childNodes[i].style.display = null;\n\n\tif (config.align === 'middle')\n\t\tel.setAttribute('transform', `translate(0, -${(el.getBBox().height - physLn) / 2})`)\n\telse if (config.align === 'baseline')\n\t\tel.setAttribute('transform', `translate(0, -${config.lineHeight - physLn})`)\n\telse if (config.align === 'bottom')\n\t\tel.setAttribute('transform', `translate(0, -${el.getBBox().height - physLn})`)\n\telse if (config.align === 'top')\n\t\tel.setAttribute('transform', `translate(0, ${physLn})`)\n}\n\n/**\n * Creates a new wrapper directive with the given configuration.\n * @param {ITextWrapperConfiguration} config A configuration object.\n */\nfunction directive(config) {\n\tif (!config) config = {};\n\tconst r = {\n\t\tinserted(el, binding) {\n\t\t\tif (!(el instanceof SVGTextElement))\n\t\t\t\tthrow new Error('Text-wrap directive must be bound to an SVG text element.');\n\t\t\tel.__WRAP_CONFIG = getConfig(binding.modifiers, config);\n\t\t\tr.update.apply(this, arguments);\n\t\t},\n\t\tupdate(el, binding, { context }) {\n\t\t\tif (binding.value !== binding.oldValue) {\n\t\t\t\tlet cfg = el.__WRAP_CONFIG\n\t\t\t\tif (binding.value && (typeof binding.value) !== 'string') {\n\t\t\t\t\tconst text = binding.value.text;\n\t\t\t\t\tcfg = Object.assign({}, el.__WRAP_CONFIG, binding.value)\n\t\t\t\t\tset(el, text, cfg);\n\t\t\t\t} else\n\t\t\t\t\tset(el, binding.value, cfg);\n\t\t\t\tif (cfg.afterReflow)\n\t\t\t\t\tcfg.afterReflow.call(context, el, cfg);\n\t\t\t}\n\t\t},\n\t\tunbind(el) {\n\t\t\tdelete el.__WRAP_CONFIG;\n\t\t}\n\t};\n\treturn r;\n}\nconst Wrapper = directive();\nexport default Wrapper;\n\nexport const ConfiguredWrapper = directive;"]}