{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.pf.js","sourcesContent":["const SVG_NS = 'http://www.w3.org/2000/svg';\nconst alignments = { 'top': true, 'baseline': true, 'bottom': true, 'middle': true }\nfunction getConfig(mod, cfg) {\n\tconst ret = {\n\t\t'plain': !cfg.plain ? false : true,\n\t\t'width': null || cfg.width,\n\t\t'align': cfg.align === 'none' ? false : (alignments[cfg.align] ? cfg.align : 'baseline'),\n\t\t'lineHeight': cfg.lineHeight || '1.125em',\n\t\t'paddingLeft': !cfg.paddingLeft ? (!cfg.padding ? 0 : cfg.padding) : cfg.paddingLeft,\n\t\t'paddingRight': !cfg.paddingRight ? (!cfg.padding ? 0 : cfg.padding) : cfg.paddingRight,\n\t\t'afterReflow': cfg.afterReflow instanceof Function ? cfg.afterReflow : false\n\t};\n\tret._padding = ret.paddingLeft + ret.paddingRight;\n\tfor (let k in mod) {\n\t\tif (k === 'plain') ret.plain = true;\n\t\telse if (alignments[k]) {\n\t\t\tret.align = k;\n\t\t} else if (k === 'none') {\n\t\t\tret.align = false\n\t\t} else if (/\\d+/.test(k))\n\t\t\tret.width = parseInt(k);\n\t}\n\treturn ret;\n}\n/**\n * @param {SVGTextElement} el \n * @param {SVGTSpanElement} span \n * @param {*} config \n */\nfunction newLine(el, span, config) {\n\tconst tmp = span.cloneNode();\n\tel.insertBefore(tmp, span.nextSibling);\n\tspan.style.display = '';\n\ttmp.removeAttribute('y');\n\ttmp.setAttribute('dy', config.lineHeight);\n\tif (!config.align) // set explicitly when not aligning (i.e. don't use text's transform)\n\t\ttmp.setAttribute('x', config.paddingLeft);\n\telse\n\t\ttmp.setAttribute('x', 0);\n\treturn tmp;\n}\n/**\n * @param {SVGTextElement} el \n * @param {String} text \n * @param {Object} config \n */\nfunction set(el, text, config) {\n\tel[config.plain ? 'textContent' : 'innerHTML'] = text || '';\n\tconst h0 = el.getBoundingClientRect().height;\n\tconst plain = [];\n\t// convert text nodes to tspans, clear spans\n\tfor (let i = 0; i < el.childNodes.length; i++) {\n\t\tlet n = el.childNodes[i];\n\t\tif (n instanceof Text) {\n\t\t\tconst tmp = document.createElementNS(SVG_NS, 'tspan');\n\t\t\ttmp.textContent = n.textContent;\n\t\t\tel.replaceChild(tmp, n);\n\t\t\tn = tmp;\n\t\t}\n\t\tplain.push(n.textContent.split(/\\s/));\n\t\tn.textContent = '';\n\t}\n\tif (!config.align) {\n\t\t// set explicitly when not aligning (i.e. don't use text's transform)\n\t\tel.childNodes[0].setAttribute('x', config.paddingLeft);\n\t}\n\tif (config.width) {\n\t\tfor (let i = 0; i < el.childNodes.length; i++) {\n\t\t\tlet n = el.childNodes[i];\n\t\t\tif (n instanceof Text) {\n\t\t\t\tconst tmp = document.createElementNS(SVG_NS, 'tspan');\n\t\t\t\ttmp.textContent = n.textContent;\n\t\t\t\tel.replaceChild(tmp, n);\n\t\t\t\tn = tmp;\n\t\t\t}\n\t\t\tplain.push(n.textContent.split(/\\s/));\n\t\t}\n\n\t\t// float texts\n\t\tlet offset = 0, w = config.width - config._padding, childCnt = el.childElementCount;\n\t\tfor (let c = 0; c < childCnt; c++) {\n\t\t\tconst words = plain[c];\n\t\t\tlet wc = words.length, span = el.childNodes[c + offset], txt = '', forceBreak = false;\n\t\t\tfor (let i = 0; i < wc; i++) {\n\t\t\t\tspan.textContent += i ? ' ' + words[i] : words[i];\n\t\t\t\tforceBreak = el.getBoundingClientRect().width > w;\n\t\t\t\twhile (forceBreak) {\n\t\t\t\t\tspan.textContent = txt;\n\t\t\t\t\tspan = newLine(el, span, config);\n\t\t\t\t\ttxt = span.textContent = words[i];\n\t\t\t\t\toffset++;\n\t\t\t\t\tif (el.getBoundingClientRect().width > w) {\n\t\t\t\t\t\tspan.style.display = 'none'; // too long word, hide for further correct measurements\n\t\t\t\t\t\ttxt = words[++i];\n\t\t\t\t\t\tif (!txt) forceBreak = false;\n\t\t\t\t\t} else forceBreak = false;\n\t\t\t\t}\n\t\t\t\ttxt = span.textContent;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!el.childNodes.length)\n\t\treturn;\n\n\tfor (let i = 0; i < el.childNodes.length; i++) {\n\t\tel.childNodes[i].style.display = '';\n\t}\n\n\tif (config.align === 'middle')\n\t\tel.setAttribute('transform', `translate(${config.paddingLeft}, ${-(el.getBoundingClientRect().height - 1.5 * h0) / 2})`)\n\telse if (config.align === 'baseline')\n\t\tel.setAttribute('transform', `translate(${config.paddingLeft}, 0)`)\n\telse if (config.align === 'bottom')\n\t\tel.setAttribute('transform', `translate(${config.paddingLeft}, ${-(el.getBoundingClientRect().height - h0)})`)\n\telse if (config.align === 'top')\n\t\tel.setAttribute('transform', `translate(${config.paddingLeft}, ${h0})`)\n}\n\n/**\n * Creates a new wrapper directive with the given configuration.\n * @param {ITextWrapperConfiguration} config A configuration object.\n */\nfunction directive(config) {\n\tif (!config) config = {};\n\tconst r = {\n\t\tinserted(el, binding) {\n\t\t\tif (!(el instanceof SVGTextElement))\n\t\t\t\tthrow new Error('Text-wrap directive must be bound to an SVG text element.');\n\t\t\tel.__WRAP_CONFIG = getConfig(binding.modifiers, config);\n\t\t\tr.update.apply(this, arguments);\n\t\t},\n\t\tupdate(el, binding, { context }) {\n\t\t\tif (binding.value !== binding.oldValue) {\n\t\t\t\tlet cfg = el.__WRAP_CONFIG\n\t\t\t\tif (binding.value && (typeof binding.value) !== 'string') {\n\t\t\t\t\tconst text = binding.value.text;\n\t\t\t\t\tcfg = getConfig({}, Object.assign({}, el.__WRAP_CONFIG, binding.value));\n\t\t\t\t\tset(el, text, cfg);\n\t\t\t\t} else\n\t\t\t\t\tset(el, binding.value, cfg);\n\t\t\t\tif (cfg.afterReflow)\n\t\t\t\t\tcfg.afterReflow.call(context, el, cfg);\n\t\t\t}\n\t\t},\n\t\tunbind(el) {\n\t\t\tdelete el.__WRAP_CONFIG;\n\t\t}\n\t};\n\treturn r;\n}\nconst Wrapper = directive();\nexport default Wrapper;\n\nexport const ConfiguredWrapper = directive;"]}